<!-- Copyright 2019 VMware, Inc.
SPDX-License-Identifier: BSD-2-Clause -->
  <clr-alert [clrAlertType]="alertType" (clrAlertClosedChange)="close()" [clrAlertClosed]= "alertclose">
    <div class="alert-item">
        <span class="alert-text">
            {{alertcontent}}
        </span>
    </div>
  </clr-alert>
  <clr-modal [(clrModalOpen)]="updateExpiredTime" [clrModalSize]="'lg'" [clrModalStaticBackdrop] = "true" [clrModalClosable] = "false">
    <h3 class="modal-title">Update Persistent Time</h3>
    <div class="modal-body" style="height: 8.5vw;">
       
            <form #timeForm="ngForm" >
                <section class="form-block">
                    <div class="form-group">
                        <label class="required"  for="timeRange">Time Range</label>
                        <label for="timeRange" style="margin-right:1px;"
                            aria-haspopup="true"
                            role="tooltip"
                            class="tooltip tooltip-validation tooltip-md tooltip-bottom-right"
                            [class.invalid]="getValidationState()">
                            <input type="text" id="timeRange" placeholder="Confirm Password"
                                required
                                pattern="^\d+$|^\d+[.]?\d+$"
                                name="timeRange"
                                [(ngModel)]="toUpdateExpiredTimeRange"
                                #timeRangeInput="ngModel"
                                (input)='handleValidation("timeRange", true)' 
                            (blur)='handleValidation("timeRange", true)'
                            (change)='handleValidation("timeRange", true)'
                            >
                            
                            <span class="tooltip-content">
                                 Time range should only be number.And the value must more than 90 days.
                            </span>
                        </label>
                        <span>days</span>
                        </div>
                        <div *ngIf="errorShow" style="color: crimson">
                                {{errorMsg}}
                                
                        </div>
                        <div >
                                <button type="submit" class="btn btn-primary" on-click="save()" [disabled]="getValidationState()">Submit</button>
                                <button type="button" class="btn btn-primary" on-click="reset()">Close</button>
                        </div>
                        
                </section>
            </form>
                        
       
    </div>
</clr-modal>
  <clr-tabs>
        <clr-tab *appHasPrivilege=integrationSummary>
            <button clrTabLink (click)="getFirstPageData()">Integration Summary</button>
            <clr-tab-content *clrIfActive="true">
                <h5>Data Center Facility System</h5>
                <div class="row" style="height:43%;max-height: 200px;">
                    <div class="col-lg-3 col-sm-3 col-3">
                        <div class="card" style="height:110%;">
                            <div class="row">
                                <span class="bigTitle">ASSETS</span>
                            </div>
                            <div class="row">
                                <span class="bigFont">{{flowgateSummery.assetsNum}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-3 col-3">
                        <div class="card btn" style="height:110%;" (click)="showSystemSummary()">
                            <div class="row">
                                <span class="bigTitle">SYSTEM</span>
                            </div>
                            <div class="row">
                                <span class="bigFont">{{flowgateSummery.facilitySystemNum}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-sm-6 col-6">
                        <div class="card" style="height:110%;">
                            <div class="row" style="margin: auto;">
                                <div class="col-lg-4 col-sm-4 col-4">
                                    <div class="row">
                                        <span class="smallTitle">SERVERS</span>
                                    </div>
                                    <div class="row">
                                        <span class="smallFont">{{flowgateSummery.serverNum}}</span>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-sm-4 col-4">
                                    <div class="row">
                                        <span class="smallTitle">PDUS</span>
                                    </div>
                                    <div class="row">
                                        <span class="smallFont">{{flowgateSummery.pduNum}}</span>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-sm-4 col-4">
                                    <div class="row">
                                        <span class="smallTitle">CABINETS</span>
                                    </div>
                                    <div class="row">
                                        <span class="smallFont">{{flowgateSummery.cabinetNum}}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin: auto;padding-top: 4%;">
                                <div class="col-lg-4 col-sm-4 col-4">
                                    <div class="row">
                                        <span class="smallTitle">NETWORK DEVICES</span>
                                    </div>
                                    <div class="row">
                                        <span class="smallFont">{{flowgateSummery.switchNum}}</span>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-sm-4 col-4">
                                    <div class="card btn" style="border:0px;margin: 0px" (click)="showSensorSummary()">
                                        <div class="row"  style="line-height: 1.0rem;">
                                            <span class="smallTitle">SENSORS</span>
                                        </div>
                                        <div class="row" style="line-height: 1.0rem;">
                                            <span class="smallFont">{{flowgateSummery.sensorNum}}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4 col-sm-4 col-4">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <h5 style="margin-top:8%;"> IT Management System</h5>
                <div class="row">
                    <div class="col-lg-3 col-sm-3 col-3">
                        <div class="card">
                            <div class="row">
                                <span class="bigTitle">USERS</span>
                            </div>
                            <div class="row">
                                <span class="bigFont">{{flowgateSummery.userNum}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-3 col-3">
                        <div class="card btn" (click)="showServerSummary()">
                            <div class="row">
                                <span class="bigTitle">SERVERS</span>
                            </div>
                            <div class="row">
                                <span class="bigFont">{{flowgateSummery.sddcServerNum}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-sm-6 col-6">
                        <div class="card">
                            <div class="row">
                                <div class="col-lg-6 col-sm-6 col-6">
                                    <div class="row">
                                        <span class="integrationTitle">Total IT Management System</span>
                                    </div>
                                    <div class="row">
                                        <span class="integrationFont">{{flowgateSummery.sddcIntegrationNum}}</span>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-sm-6 col-6">
                                    <div class="row">
                                        <div class="col-lg-12 col-sm-12 col-12">
                                            <div class="row">
                                                <span class="integrationSmallTitle">VMware vCenter Server</span>
                                            </div>
                                            <div class="row">
                                                <span class="integrationSmallFont">{{flowgateSummery.vcNum}}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 col-sm-12 col-12">
                                            <div class="row">
                                                <span class="integrationSmallTitle">vRealize Operations Manager</span>
                                            </div>
                                            <div class="row">
                                                <span class="integrationSmallFont">{{flowgateSummery.vroNum}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </clr-tab-content>
        </clr-tab>
        <clr-tab *appHasPrivilege=assetTopology>
            <button clrTabLink>Asset Topology</button>
            <clr-tab-content *clrIfActive>
                <setting-asset></setting-asset>
            </clr-tab-content>
        </clr-tab>
        <clr-tab *appHasPrivilege=syncData>
            <button (click)="getExpiredTimeRange()" clrTabLink>Sync Data</button>
            <clr-tab-content *clrIfActive>
                <div class="row">
                    <div class="col-md-10">
                        <h5>Sync Data</h5>
                        <clr-datagrid>
        
                            <clr-dg-column>Job</clr-dg-column>
                            <clr-dg-column>Description</clr-dg-column>
                            <clr-dg-column>Option</clr-dg-column>
                            
                            <clr-dg-placeholder>We couldn't find any job!</clr-dg-placeholder>
                            
                            
                            <clr-dg-row>
                            
                                <clr-dg-cell style="margin-top: 0.5%;font-size: 14px;line-height: 20px;">Aggregate Server Mappings job</clr-dg-cell>
                                <clr-dg-cell style="margin-top: 0.5%;word-wrap: break-word;font-size: 14px;line-height: 20px;
                                word-break: normal;">Manually trigger the aggregate Server mapping jobs.
                                    It will merge mappings between different SDDC systems and Facility system into one item.
                                    The merge strategy is try it's best to merge. 
                                    This job will also triggered automatically daily.</clr-dg-cell>
                                <clr-dg-cell >
                                <button style="margin:0px;" [clrLoading]="serverMapping" class="btn btn-info-outline" (click)="trigger('job1')">Trigger</button>
                                </clr-dg-cell>
                                
                            </clr-dg-row>
                            <clr-dg-row>
                            
                                <clr-dg-cell style="margin-top: 0.5%;font-size: 14px;line-height: 20px;">Trigger aggregate PDUs and Server Mapping job</clr-dg-cell>
                                <clr-dg-cell style="margin-top: 0.5%;word-wrap: break-word;font-size: 14px;line-height: 20px;
                                word-break: normal;">Manually Trigger the aggregate PDUs and Server mapping job.
                                    It will try to find out the possible PDUs that a server is connected to. 
                                    The job will automatically executed by daily.</clr-dg-cell>
                                <clr-dg-cell >
                                <button style="margin:0px;" [clrLoading]="pduMapping" class="btn btn-info-outline" (click)="trigger('job2')">Trigger</button>
                                </clr-dg-cell>
                                
                            </clr-dg-row>

                            <clr-dg-row>
                            
                                <clr-dg-cell style="margin-top: 0.5%;font-size: 14px;line-height: 20px;">Sync server and sensors mapping</clr-dg-cell>
                                <clr-dg-cell style="margin-top: 0.5%;word-wrap: break-word;font-size: 14px;line-height: 20px;
                                word-break: normal;">Sync the server and sensors mapping for all the servers in the system.</clr-dg-cell>
                                <clr-dg-cell >
                                <button style="margin:0px;" [clrLoading]="temphumidityMapping" class="btn btn-info-outline" (click)="trigger('job3')">Trigger</button>
                                </clr-dg-cell>
                                
                            </clr-dg-row>
                        
                            </clr-datagrid>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-10">
                        <h5>Sensors Metrics Data Persistent Time Setting </h5>
                        <clr-datagrid>
        
                            <clr-dg-column >Time Range</clr-dg-column>
                            <clr-dg-column>Description</clr-dg-column>
                            <clr-dg-column>Option</clr-dg-column>
                            
                            <clr-dg-row>
                            
                                <clr-dg-cell style="margin-top: 0.5%">{{expiredTimeRange}} days</clr-dg-cell>
                                <clr-dg-cell style="margin-top: 0.5%">It means time range for executing the job to clear data.<br>By default it's 90 days,you can modify it but the value is at least 90 days. </clr-dg-cell>
                                <clr-dg-cell >
                                <button  class="btn btn-info-outline" (click)="updateExpiredTimeRange()">Modify</button>
                                </clr-dg-cell>
                                
                            </clr-dg-row>
                         </clr-datagrid>
                    </div>
                </div>
            </clr-tab-content>
        </clr-tab>
        
            <clr-tab *appHasPrivilege=syncUnMappedServers>
                <button clrTabLink>Unmapped Servers</button>
                <clr-tab-content *clrIfActive>
                    <div class="row">
                        <div class="col-md-3">
                            <button [clrLoading]="serverloading" class="btn btn-info-outline "  (click)="getunmappedservers()" style="margin-top:10px;" >
                                Pull Unmapped Servers       
                            </button>
                        
                            <clr-datagrid *ngIf="unmappedservershow">
                                
                                <clr-dg-column>server</clr-dg-column>
                                
                                <clr-dg-placeholder>We couldn't find any unmapped server!</clr-dg-placeholder>
                                
                                
                                <clr-dg-row *ngFor="let item of servers">
                                
                                    <clr-dg-cell >{{item}}</clr-dg-cell>
                                    
                                    
                                </clr-dg-row>
                            
                                </clr-datagrid>
                        </div>
                    </div>
                </clr-tab-content>
            </clr-tab>
    </clr-tabs>

<clr-modal [(clrModalOpen)]="systemSummary" [clrModalStaticBackdrop]="true" [clrModalSize]="'xl'">
    <h3 class="modal-title">Data Center Facility System</h3>
    <div class="modal-body" style="height: 600px;">
        <div class="row">
            <div class="col-md-12 trigger-job-text-center">
                <clr-tree-node>
                    Nlyte
                    <ng-template [clrIfExpanded]="true">
                        <clr-tree-node>
                            <div class="col-md-12" style="margin-left:-1.25rem;">
                                <clr-datagrid>
                                    <clr-dg-column style="min-width: 17rem;">Nlyte System</clr-dg-column>
                                    <clr-dg-column>SERVER</clr-dg-column>
                                    <clr-dg-column>PDU</clr-dg-column>
                                    <clr-dg-column>CABINET</clr-dg-column>
                                    <clr-dg-column>NETWORK DEVICES</clr-dg-column>
                                    <clr-dg-column>SENSORS</clr-dg-column>

                                    <clr-dg-placeholder>We couldn't find any Nlyte System!</clr-dg-placeholder>

                                    <clr-dg-row *ngFor="let nlyte of flowgateSummery.nlyteSummary"> 
                                        <clr-dg-cell style="min-width: 17rem;text-align: center;">
                                            <span class="systemDetailTitle">{{nlyte.name}}</span>
                                            <br>
                                            <span class="systemDetailSubTitle">{{nlyte.url}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{nlyte.serverNum}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{nlyte.pduNum}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{nlyte.cabinetNum}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{nlyte.switchNum}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{nlyte.sensorNum}}</span>
                                        </clr-dg-cell>
                                    </clr-dg-row>
                                </clr-datagrid>
                            </div>
                        </clr-tree-node>
                    </ng-template>
                </clr-tree-node>
                <clr-tree-node>
                    PowerIQ
                    <ng-template [clrIfExpanded]="false">
                        <clr-tree-node>
                            <div class="col-md-12" style="margin-left:-1.25rem;">
                                <clr-datagrid>
                                    <clr-dg-column>PowerIQ System</clr-dg-column>
                                    <clr-dg-column>SENSOR</clr-dg-column>
                                    <clr-dg-column>PDU</clr-dg-column>

                                    <clr-dg-placeholder>We couldn't find any PowerIQ System!</clr-dg-placeholder>

                                    <clr-dg-row *ngFor="let PowerIQ of flowgateSummery.powerIqSummary"> 
                                        <clr-dg-cell>
                                            <span class="systemDetailTitle">{{PowerIQ.name}}</span>
                                            <br>
                                            <span class="systemDetailSubTitle">{{PowerIQ.url}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{PowerIQ.sensorNum}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{PowerIQ.pduNum}}</span>
                                        </clr-dg-cell>
                                    </clr-dg-row>
                                </clr-datagrid>
                            </div>
                        </clr-tree-node>
                    </ng-template>
                </clr-tree-node>
                <clr-tree-node>
                    Infoblox
                    <ng-template [clrIfExpanded]="false">
                        <clr-tree-node>NO DATA.</clr-tree-node>
                    </ng-template>
                </clr-tree-node>
                <clr-tree-node>
                    LabsDB
                    <ng-template [clrIfExpanded]="false">
                        <clr-tree-node>NO DATA.</clr-tree-node>
                    </ng-template>
                </clr-tree-node>
            </div>
        </div>
        
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="systemConfirm()">Ok</button>
    </div>
</clr-modal>
<clr-modal [(clrModalOpen)]="serverSummary" [clrModalStaticBackdrop]="true" [clrModalSize]="'xl'">
    <h3 class="modal-title">IT Management System</h3>
    <div class="modal-body" style="height: 600px;">
        <div class="row">
            <div class="col-md-12 trigger-job-text-center">
                <clr-tree-node>
                    VMware vCenter
                    <ng-template [clrIfExpanded]="true">
                        <clr-tree-node>
                            <div class="col-md-12" style="margin-left:-1.25rem;">
                                <clr-datagrid>
                                    <clr-dg-column>VMware vCenter Server</clr-dg-column>
                                    <clr-dg-column>Managed Host Number</clr-dg-column>

                                    <clr-dg-placeholder>We couldn't find any VMware vCenter Server!</clr-dg-placeholder>

                                    <clr-dg-row *ngFor="let vc of flowgateSummery.vcSummary"> 
                                        <clr-dg-cell>
                                            <span class="systemDetailTitle">{{vc.name}}</span>
                                            <br>
                                            <span class="systemDetailSubTitle">{{vc.url}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{vc.hostsNum}}</span>
                                        </clr-dg-cell>
                                    </clr-dg-row>
                                </clr-datagrid>
                            </div>
                        </clr-tree-node>
                    </ng-template>
                </clr-tree-node>
                <clr-tree-node>
                    VMware vRealize Operations Manager
                    <ng-template [clrIfExpanded]="false">
                        <clr-tree-node>
                            <div class="col-md-12" style="margin-left:-1.25rem;">
                                <clr-datagrid>
                                    <clr-dg-column>VMware vRealize Operations Manager</clr-dg-column>
                                    <clr-dg-column>Managed Host Number</clr-dg-column>

                                    <clr-dg-placeholder>We couldn't find any VMware vRealize Operations Manager!</clr-dg-placeholder>

                                    <clr-dg-row *ngFor="let vro of flowgateSummery.vroSummary"> 
                                        <clr-dg-cell>
                                            <span class="systemDetailTitle">{{vro.name}}</span>
                                            <br>
                                            <span class="systemDetailSubTitle">{{vro.url}}</span>
                                        </clr-dg-cell>
                                        <clr-dg-cell>
                                            <span class="systemDetailFont">{{vro.hostsNum}}</span>
                                        </clr-dg-cell>
                                    </clr-dg-row>
                                </clr-datagrid>
                            </div>
                        </clr-tree-node>
                    </ng-template>
                </clr-tree-node>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="serverConfirm()">Ok</button>
    </div>
</clr-modal>
<clr-modal [(clrModalOpen)]="sensorSummary" [clrModalStaticBackdrop]="true" [clrModalSize]="'lg'">
    <h3 class="modal-title">Sensor Summary</h3>
    <div class="modal-body" style="height: 500px;">
        <div class="row" style="margin:auto; ">
            <div class="col-lg-4 col-sm-4 col-4">
                <div class="card sensorCard" >
                    <div class="row" style="margin:auto;">
                        <span class="modalBigTitle">Humidity</span>
                    </div>
                    <div class="row" style="margin:auto;">
                        <span class="modalBigFont">{{flowgateSummery.humiditySensorNum}}</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-sm-4 col-4">
                <div class="card sensorCard">
                    <div class="row" style="margin:auto;">
                        <span class="modalBigTitle">Temperature</span>
                    </div>
                    <div class="row" style="margin:auto;">
                        <span class="modalBigFont">{{flowgateSummery.temperatureSensorNum}}</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-sm-4 col-4">
                <div class="card sensorCard">
                    <div class="row" style="margin:auto;">
                        <span class="modalBigTitle">AirFlow</span>
                    </div>
                    <div class="row" style="margin:auto;">
                        <span class="modalBigFont">{{flowgateSummery.airFlowSensorNum}}</span>
                    </div>
                </div>
            </div>
            
        </div>
        <div class="row" style="margin:auto; padding-top: 100px;">
            <div class="col-lg-4 col-sm-4 col-4">
                <div class="card sensorCard">
                    <div class="row" style="margin:auto;">
                        <span class="modalBigTitle">Smoke</span>
                    </div>
                    <div class="row" style="margin:auto;">
                        <span class="modalBigFont">{{flowgateSummery.smokeSensorNum}}</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-sm-4 col-4">
                <div class="card sensorCard">
                    <div class="row" style="margin:auto;">
                        <span class="modalBigTitle">Water</span>
                    </div>
                    <div class="row" style="margin:auto;">
                        <span class="modalBigFont">{{flowgateSummery.waterSensorNum}}</span>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-sm-4 col-4">
                
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="sensorConfirm()">Ok</button>
    </div>
</clr-modal>